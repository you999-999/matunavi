# åˆè¨º/å†è¨ºæ©Ÿèƒ½å®Ÿè£…å®Œäº†å ±å‘Š

## âœ… å®Ÿè£…å®Œäº†é …ç›®

### 1. DBè¨­è¨ˆã®å¤‰æ›´
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `batch/add_visit_type_to_form_response.sql`
- **å†…å®¹**: `form_response` ãƒ†ãƒ¼ãƒ–ãƒ«ã« `visit_type` ã‚«ãƒ©ãƒ ã‚’è¿½åŠ 
  - `'first'`ï¼ˆåˆè¨ºï¼‰
  - `'repeat'`ï¼ˆå†è¨ºï¼‰
  - NULLè¨±å®¹ï¼ˆæœªå…¥åŠ›ãƒ‡ãƒ¼ã‚¿å¯¾ç­–ï¼‰

### 2. å…¥åŠ›UIã®è¿½åŠ 
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `web/src/components/search-ui-example.tsx`
- **å†…å®¹**: å¾…ã¡æ™‚é–“å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã«ã€Œä»Šå›žã®å—è¨ºã¯ï¼Ÿã€ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ã‚’è¿½åŠ 
  - åˆè¨º / å†è¨ºã®2æŠž
  - å¿…é ˆå…¥åŠ›ã§ã¯ãªã„ï¼ˆä»»æ„é …ç›®ï¼‰
  - ãƒ¯ãƒ³ã‚¿ãƒƒãƒ—ã§å®Œäº†

### 3. ä¿å­˜å‡¦ç†
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `web/src/components/search-ui-example.tsx`
- **å†…å®¹**: `handleSubmit` é–¢æ•°ã§ `visit_type` ã‚’ä¿å­˜
  - æœªé¸æŠžæ™‚ã¯ `null` ã‚’ä¿å­˜

### 4. äºˆç´„å¾…ã¡ç¯„å›²ã®è¨ˆç®—
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `web/src/components/WaitTimeChart.tsx`
- **å†…å®¹**: äºˆç´„å¾…ã¡æ™‚é–“ = è¨ºå¯Ÿé–‹å§‹æ™‚é–“ - äºˆç´„é–‹å§‹æ™‚é–“ï¼ˆåˆ†ï¼‰
  - 15åˆ†ä»¥ä¸‹
  - 30åˆ†ä»¥ä¸‹
  - 45åˆ†ä»¥ä¸‹
  - ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§è¨ˆç®—

### 5. é›†è¨ˆãƒ­ã‚¸ãƒƒã‚¯
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `web/src/components/WaitTimeChart.tsx`
- **å†…å®¹**: 3ãƒ‘ã‚¿ãƒ¼ãƒ³ã®é›†è¨ˆã‚’å®Ÿè£…
  - â‘  å…¨ä½“ï¼ˆvisit_type ãŒ NULL ã®ãƒ‡ãƒ¼ã‚¿ã‚‚å«ã‚€ï¼‰
  - â‘¡ åˆè¨ºã®ã¿ï¼ˆvisit_type = 'first'ï¼‰
  - â‘¢ å†è¨ºã®ã¿ï¼ˆvisit_type = 'repeat'ï¼‰
  - é€šå¸¸å¾…ã¡æ™‚é–“ã®å¹³å‡ãƒ»ä¸­å¤®å€¤
  - äºˆç´„å¾…ã¡ç¯„å›²ï¼ˆ15/30/45åˆ†ä»¥ä¸‹ï¼‰ã®ä»¶æ•°ãƒ»å‰²åˆ

### 6. UIè¡¨ç¤º
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `web/src/components/WaitTimeChart.tsx`
- **å†…å®¹**: ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆUIã‚’å®Ÿè£…
  - ã‚¿ãƒ–ï¼šå…¨ä½“ / åˆè¨º / å†è¨º
  - ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆã§åŒã˜ã‚°ãƒ©ãƒ•ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ãƒ•ã‚£ãƒ«ã‚¿æ¡ä»¶ã‚’æ¸¡ã™æ§‹æˆ

### 7. ã‚°ãƒ©ãƒ•è¡¨ç¤º
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `web/src/components/WaitTimeChart.tsx`
- **å†…å®¹**: æ¨ªæ£’ã‚°ãƒ©ãƒ•ã‚’å®Ÿè£…
  - é …ç›®ï¼š15åˆ†ä»¥å†… / 30åˆ†ä»¥å†… / 45åˆ†ä»¥å†…
  - å…¨ä½“ï¼åˆè¨ºï¼å†è¨ºã§æ•°å€¤ãŒåˆ‡ã‚Šæ›¿ã‚ã‚‹
  - ä»¶æ•°ã¨å‰²åˆã‚’è¡¨ç¤º

### 8. æ³¨æ„ç‚¹ã®å®Ÿè£…
- ãƒ‡ãƒ¼ã‚¿ä»¶æ•°ãŒ10ä»¶æœªæº€ã®å ´åˆã¯ã€Œå‚è€ƒå€¤ï¼ˆãƒ‡ãƒ¼ã‚¿ä»¶æ•°ãŒå°‘ãªã„ãŸã‚ï¼‰ã€ã‚’è¡¨ç¤º
- `visit_type` ãŒ NULL ã®ãƒ‡ãƒ¼ã‚¿ã¯ã€Œå…¨ä½“ã€ã®ã¿é›†è¨ˆã«å«ã‚ã‚‹

---

## ðŸ“‹ å®Ÿè¡Œæ‰‹é †

### 1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒžæ›´æ–°

Supabaseã®SQL Editorã§ä»¥ä¸‹ã‚’å®Ÿè¡Œï¼š

```sql
-- form_response ãƒ†ãƒ¼ãƒ–ãƒ«ã« visit_type ã‚«ãƒ©ãƒ ã‚’è¿½åŠ 
ALTER TABLE form_response 
ADD COLUMN IF NOT EXISTS visit_type TEXT CHECK (visit_type IN ('first', 'repeat'));

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¿½åŠ 
CREATE INDEX IF NOT EXISTS idx_form_response_visit_type ON form_response(visit_type);
```

### 2. å‹•ä½œç¢ºèª

1. æ–½è¨­è©³ç´°ãƒšãƒ¼ã‚¸ã‚’é–‹ã
2. å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã«ã€Œä»Šå›žã®å—è¨ºã¯ï¼Ÿã€ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
3. åˆè¨º/å†è¨ºã‚’é¸æŠžã—ã¦é€ä¿¡
4. ã€Œå¾…ã¡æ™‚é–“ãƒ»äºˆç´„å¾…ã¡ç¯„å›²ã‚°ãƒ©ãƒ•ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆãŒå‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèª
5. å…¨ä½“/åˆè¨º/å†è¨ºã§ã‚°ãƒ©ãƒ•ãŒåˆ‡ã‚Šæ›¿ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª

---

## ðŸ“Š ã‚°ãƒ©ãƒ•è¡¨ç¤ºå†…å®¹

### é€šå¸¸å¾…ã¡æ™‚é–“
- å¹³å‡å¾…ã¡æ™‚é–“ï¼ˆåˆ†ï¼‰
- ä¸­å¤®å€¤å¾…ã¡æ™‚é–“ï¼ˆåˆ†ï¼‰
- ã‚µãƒ³ãƒ—ãƒ«æ•°

### äºˆç´„å¾…ã¡ç¯„å›²
- 15åˆ†ä»¥å†…ï¼ˆä»¶æ•°ãƒ»å‰²åˆï¼‰
- 30åˆ†ä»¥å†…ï¼ˆä»¶æ•°ãƒ»å‰²åˆï¼‰
- 45åˆ†ä»¥å†…ï¼ˆä»¶æ•°ãƒ»å‰²åˆï¼‰

---

## ðŸ” å®Ÿè£…ã®è©³ç´°

### ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°

```typescript
// å…¨ä½“: ãƒ•ã‚£ãƒ«ã‚¿ãªã—ï¼ˆvisit_type ãŒ NULL ã®ãƒ‡ãƒ¼ã‚¿ã‚‚å«ã‚€ï¼‰
let query = supabase.from('form_response').select('...');

// åˆè¨ºã®ã¿
query = query.eq('visit_type', 'first');

// å†è¨ºã®ã¿
query = query.eq('visit_type', 'repeat');
```

### äºˆç´„å¾…ã¡æ™‚é–“ã®è¨ˆç®—

```typescript
// äºˆç´„å¾…ã¡æ™‚é–“ = è¨ºå¯Ÿé–‹å§‹æ™‚é–“ - äºˆç´„é–‹å§‹æ™‚é–“ï¼ˆåˆ†ï¼‰
const reservation = new Date(`2000-01-01T${item.reservation_time}`);
const treatment = new Date(`2000-01-01T${item.treatment_start_time}`);
const reservationWaitMinutes = (treatment.getTime() - reservation.getTime()) / (1000 * 60);
```

### äºˆç´„å¾…ã¡ç¯„å›²ã®é›†è¨ˆ

```typescript
const reservationWaitRange = {
  range15: reservationWaitTimes.filter(t => t <= 15).length,
  range30: reservationWaitTimes.filter(t => t <= 30).length,
  range45: reservationWaitTimes.filter(t => t <= 45).length,
  total: reservationWaitTimes.length,
};
```

---

## âš ï¸ æ³¨æ„äº‹é …

1. **æ—¢å­˜ãƒ‡ãƒ¼ã‚¿**: æ—¢å­˜ã® `form_response` ãƒ‡ãƒ¼ã‚¿ã«ã¯ `visit_type` ãŒ `NULL` ã«ãªã‚Šã¾ã™ã€‚ã“ã‚Œã‚‰ã¯ã€Œå…¨ä½“ã€ã‚¿ãƒ–ã«ã®ã¿è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

2. **ãƒ‡ãƒ¼ã‚¿ä»¶æ•°**: ãƒ‡ãƒ¼ã‚¿ä»¶æ•°ãŒ10ä»¶æœªæº€ã®å ´åˆã¯ã€Œå‚è€ƒå€¤ã€ã¨è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

3. **äºˆç´„å¾…ã¡æ™‚é–“**: äºˆç´„å¾…ã¡æ™‚é–“ã¯ã€`has_reservation = 'ã‚ã‚Š'` ã‹ã¤ `reservation_time` ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿ã®ã¿è¨ˆç®—ã•ã‚Œã¾ã™ã€‚

---

## ðŸŽ¨ UI/UX

- ã‚¿ãƒ–UI: ã‚·ãƒ³ãƒ—ãƒ«ã§åˆ†ã‹ã‚Šã‚„ã™ã„ãƒ‡ã‚¶ã‚¤ãƒ³
- ã‚°ãƒ©ãƒ•: æ¨ªæ£’ã‚°ãƒ©ãƒ•ã§è¦–è¦šçš„ã«åˆ†ã‹ã‚Šã‚„ã™ã„
- è‰²åˆ†ã‘: 15åˆ†ä»¥å†…ï¼ˆç·‘ï¼‰ã€30åˆ†ä»¥å†…ï¼ˆé»„ï¼‰ã€45åˆ†ä»¥å†…ï¼ˆã‚ªãƒ¬ãƒ³ã‚¸ï¼‰
- ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–: ãƒ¢ãƒã‚¤ãƒ«ã§ã‚‚è¦‹ã‚„ã™ã„ãƒ‡ã‚¶ã‚¤ãƒ³

---

å®Ÿè£…ã¯å®Œäº†ã—ã¦ã„ã¾ã™ã€‚å‹•ä½œç¢ºèªã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚
